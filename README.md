# 08/23

## 基本アイデア
範囲内の値集合に関する一致判定が重要なので、ZobristHashだろう。
部分集合として含むかどうかなので、愚直にチェックするしかない。$L_B \leq 24$なのでまあ間に合う。

### ツアーパスの構築
目的地間は最短距離で移動するのでいいだろう。余計な迂回路のハンドリングは難しい。
強いていえば過去に通過した回数が多い道を好むくらいか。
その場合でも、目的地との距離が増加するようなことはあってはならない。

一部の来訪頂点だけで最小全域木を作って高速道路にして、地道はインターチェンジ降りる方式にしたら明確に利用頻度が別れるのでは、
最小全域木に使う頂点は、子頂点との最大距離を最小化するクラスタリングとか。

### 辞書$A$の構築
移動ごとに毎回信号を切り替える非効率なツアーを基準に考えると、確定したツアー内の区間集合と$A$の連続部分列区間集合が一致することの相対的な嬉しさは、$(ツアー内区間の長さ - 1) \times 全ツアーパス内の出現回数$でざっくり見積れるだろう。なので
1. ツアー内の区間を$O(N^2)$で全探索して、その集合Hashの出現回数を数え上げ、上記の指標で降順ソートする。
1. ソート先頭から$A$に登録していく。
1. ツアーパス内に出現する頂点番号はすべて出現させたい。容量ギリギリになってきたら未登場の頂点番号を詰め込んでいく。

### 実際のプランニング
ツアーパスと辞書を固定すると、最適なプランニングはDPで求まる。
辞書内の任意の連続区間であって、長さ$L_B$の範囲には、必ず値重複がないという仮定のもとで

1. 事前に辞書内の長さ$L_b$以下の区間について、集合のHash値を求め、Setに格納しておく。計算量は$O(N\ L_B)$。
1. $DP[i]$を、ツアー内の$i$番目の地点へ到達するまでに必要な最小の信号変更回数とする。$i$から$j(i<j)$への繊維が可能かどうかは、区間$(i, j]$内に存在する頂点番号のHash値が辞書内に存在すること。計算量は$O(N^2)$
1. BackTraceによる実際のツアープロセス復元。

でも固定ツアーパスを忘れたDijkstraの方がよさそうだ

# 08/24

最初のツアーパス構築において、何度も通っている頂点を好むにしたら多少上がった。
信号は頂点ごとなので見落としていたが、集合として指定する以上はエッジこそが重要。
ただ、利用頻度の高い頂点ではなくエッジに着目したら、ほぼ変わらず少し下がったくらい。

でも問題点は青信号集合があまりにバラバラなこと。次案は
中心付近のエッジが重要なんだろうから、中心から信号集合の道をを連結してつなげていく処理を最初にやったほうがいいのでは

# 08/25
今までの方針を全部捨てて、グラフをサイズ$L_B$ごとの部分集合に分割して、その集合間をまたぐのがコストだと見なしてやったらめっちゃよくなった。
部分集合は中心からのユークリッド距離が小さいものからつなげていく処理を書いた。ちょっとつぶれすぎな気もしなくもないけど、
単純なBFS順よりも若干良い。
あとやれることとしては、$L_A$が$N$よりも大きい場合にそれをどう使うか。
$N$までと同じ部分集合作っても仕方ないから、離れた部分集合どうしをワープするような細長い高速道路が必要な気がする。

# 08/26
信号を無視し、最速でツアーを終了させる場合のエッジ利用頻度分布を見てみたら、めちゃくちゃ偏りがあった。
利用頻度の高いエッジ部分をまず連結させてから、残りを中心から順に連結させたらスコア向上。

1. そもそも中心から順番に連結させる処理、いるか？動いてはいるけど、各部分集合が内包するエッジ利用回数の分散を大きくするとかの方がいいのでは
各部分集合を一様に膨らませるのではなく、着目した部分集合だけを一気に膨らませる方式→変化なし
融合後の部分集合サイズが大きい順に使用数1のエッジをつなぐ→変化なし
使用数ゼロ、イチも含めて接続したところで何も変わらない。ただの運要素っぽいが、かといってより良い手があるわけでもない。
1. 常に信号バッファを使い切る訳ではないのだから、必要最小限だけ使って、偶然青のまま残っていて集合間をショートカットできるならそうした方がいい。
その場合には辞書の並び順も重要になる。それこそBFS到達順とか。

# 08/27
部分集合の管理を多層化し、同一頂点が複数の集合に含まれることを許容。これで5%アップ。
結果的に、この背策によって辞書をバッファを使い切ることになった…と思ったらまだ余裕がある。
原因は、部分集合への融合回数の上限を低く見積もりすぎているため。せっかく部分集合内の連続領域を青信号で指定する使用なので、
頂点重複のある集合同士は連続させるべき。これは部分集合を頂点、重複長点数をエッジ重みとみなしたメタグラフの最大重みパスの構成に等しい。

エッジ同士のペアリングも何かやりたい。連続して使うことになるエッジは同一の部分集合に含めた方がトクなので、何かできないか。

1. 内包するエッジ重みの和で部分集合を降順ソートし、重複文字があったらバッファ上かぶらせる超貪欲
1. 0レイヤー目を作り切った後、部分集合間の距離が3以上の場合であって、L_b以内で接続させる。同時に辞書作成も行う。
1. 部分集合が内包するエッジ重み和が最大となるようにDynamicDConnectivityで焼くかビムサ
1. 0レイヤー目で使われなかったエッジの重み降順でつなぐ初期状態からの貪欲で1レイヤー目を作成する
1. 辞書が出来上がった後はUF忘れ、L_A上の連続区間であって元の頂点が連結なものを改めて頂点と解釈する